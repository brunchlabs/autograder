name: 'Autograder Action'
description: 'Automatically grades student submissions based on a report.'

inputs:
  repo:
    description: 'The repository name'
    required: true
  student:
    description: 'The student who pushed the code'
    required: true
  studentId:
    description: 'The student ID'
    required: true
  organization:
    description: 'The organization name'
    required: true
  organizationId:
    description: 'The organization ID'
    required: true
  report:
    description: 'The report generated by tests'
    required: true
  branch:
    description: 'The branch that was pushed'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        repository: brunchlabs/autograder

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Debug
      shell: bash
      run: |
        echo "Repository: ${{ inputs.repo }}"
        echo "Student: ${{ inputs.student }}"
        echo "Student ID: ${{ inputs.studentId }}"
        echo "Organization: ${{ inputs.organization }}"
        echo "Organization ID: ${{ inputs.organizationId }}"
        echo "Report: ${{ inputs.report }}"
        echo "Branch: ${{ inputs.branch }}"

    - name: Install dependencies
      shell: bash
      run: npm ci

    - name: Run autograder
      shell: bash
      run: node autograder.js
      env:
        INPUT_REPO: ${{ inputs.repo }}
        INPUT_STUDENT: ${{ inputs.student }}
        INPUT_STUDENT_ID: ${{ inputs.studentId }}
        INPUT_ORGANIZATION: ${{ inputs.organization }}
        INPUT_ORGANIZATION_ID: ${{ inputs.organizationId }}
        INPUT_REPORT: ${{ inputs.report }}
        INPUT_BRANCH: ${{ inputs.branch }}
