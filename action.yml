name: 'Autograder Action'
description: 'Automatically grades student submissions based on a report.'
inputs:
  report:
    description: 'The report generated by tests'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        repository: brunchlabs/autograder

    - name: Grade submission
      uses: fjogeleit/http-request-action@v1
      with:
        url: 'https://hookstation.classflow.brunchlabs.com/autograder'
        method: POST
        customHeaders: '{"Content-Type": "application/json"}'
        data: |
          {
            "repositoryName": "${{ github.event.repository.name }}",
            "organizationId": "${{ github.repository_owner_id }}",
            "branch": "${{ github.ref_name }}",
            "report": ${{ toJSON(inputs.report) }}
          }
